generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int           @id @default(autoincrement())
  uuid             String        @unique @default(uuid())
  name             String
  email            String
  password         String
  role             String        @default("admin")
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  transactions     Transaction[]
  carts            Cart[]

  @@map("users")
}

model Customer {
  id               Int           @id @default(autoincrement())
  uuid             String        @unique @default(uuid())
  name_perusahaan  String
  no_telp          String
  address          String
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  transactions     Transaction[]
  rentals          Rental[]
  repairs          Repair[]

  @@map("customers")
}

model Category {
  id          Int        @id @default(autoincrement())
  uuid        String     @unique @default(uuid())
  image       String?
  name        String
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  products    Product[]

  @@map("categories")
}

model Cart { // tidak perlu uuid
  id          Int       @id @default(autoincrement())
  cashier_id  Int
  product_id  Int
  qty         Int
  price       Float
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  cashier     User     @relation(fields: [cashier_id], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("carts")
}

model Product {
  id                  Int                    @id @default(autoincrement())
  uuid                String                 @unique @default(uuid())
  category_id         Int
  image               String?
  title               String
  description         String?
  sell_price          Float
  rent_price          Float?
  stock               Int
  created_at          DateTime               @default(now())
  updated_at          DateTime               @updatedAt
  category            Category               @relation(fields: [category_id], references: [id], onDelete: Cascade)
  specifications      ProductSpecification[]
  transaction_details TransactionDetail[]
  rental_details      RentalDetail[]    
  carts               Cart[]

  @@map("products")
}

model ProductSpecification {
  id               Int       @id @default(autoincrement())
  uuid             String    @unique @default(uuid())
  product_id       Int
  brand            String
  model            String
  cylinder         String
  piston_displ     String
  rated_speed      String
  bore_stroke      String
  governor         String
  aspiration       String
  oil_capacity     String
  fuel_capacity    String
  cooling_system   String
  load_100         Float
  load_75          Float
  load_50          Float
  prime_power      String
  standby_power    String
  voltage          String
  alternator       String
  dimension_open   String
  weight_open      String
  dimension_silent String
  weight_silent    String
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  product          Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("product_specifications")
}

model Transaction {
  id                  Int                  @id @default(autoincrement())
  uuid                String               @unique @default(uuid())
  cashier_id          Int
  customer_id         Int?
  invoice             String               @unique
  subtotal            Float 
  subtotalPlusExtra   Float @map("subExtraValue") 
  extra               Float?                @default(0)
  dp                  Float
  nego                Float
  pph                 Float?                @default(0)
  pph_nominal         Float?                @default(0)
  grand_total         Float
  status              String               
  created_at          DateTime             @default(now())
  cashier             User                 @relation(fields: [cashier_id], references: [id], onDelete: Cascade)
  customer            Customer?            @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  transaction_details TransactionDetail[]
  profits             Profit[]

  @@map("transactions")
}

model TransactionDetail {
  id              Int          @id @default(autoincrement())
  uuid            String       @unique @default(uuid())
  transaction_id  Int
  product_id      Int
  qty             Int
  price           Float
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  transaction     Transaction  @relation(fields: [transaction_id], references: [id], onDelete: Cascade)
  product         Product      @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("transaction_details")
}

model Rental {
  id               Int       @id @default(autoincrement())
  uuid             String    @unique @default(uuid())
  customer_id      Int
  invoice          String     @unique
  dp               Float?     @default(0)
  total_rent_price Float
  status           String
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  customer         Customer   @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  details          RentalDetail[]
  profits          Profit[]

  @@map("rentals")
}

model RentalDetail {
  id          Int       @id @default(autoincrement())
  uuid        String    @unique @default(uuid())
  rental_id   Int
  product_id  Int
  qty         Int       @default(1)
  rent_price  Float
  start_date  DateTime
  end_date    DateTime
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  rental      Rental    @relation(fields: [rental_id], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("rental_details")
}

model Repair {
  id           Int       @id @default(autoincrement())
  uuid         String    @unique @default(uuid())
  customer_id  Int
  item_repair  String 
  invoice      String     @unique
  start_date   DateTime
  end_date     DateTime
  description  String
  component    String?
  image        String?   
  pic          String   
  dp           Float?    @default(0)
  repair_cost  Float
  status       String
  created_at   DateTime    @default(now())
  updated_at   DateTime    @updatedAt
  customer     Customer    @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  profits      Profit[]

  @@map("repairs")
}

model Profit {
  id             Int        @id @default(autoincrement())
  uuid           String     @unique @default(uuid())
  source         String
  transaction_id Int?
  rental_id      Int?
  repair_id      Int?
  total          Float
  created_at     DateTime    @default(now())

  transaction    Transaction? @relation(fields: [transaction_id], references: [id], onDelete: Cascade)
  rental         Rental?      @relation(fields: [rental_id], references: [id], onDelete: Cascade)
  repair         Repair?      @relation(fields: [repair_id], references: [id], onDelete: Cascade)

  @@map("profits")
}

model Project {
  id           Int       @id @default(autoincrement())
  uuid         String    @unique @default(uuid())
  image        String
  project_name String
  location     String
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  @@map("projects")
}

model Partnership {
  id         Int       @id @default(autoincrement())
  uuid       String    @unique @default(uuid())
  name       String
  image      String     
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  @@map("partnerships")
}

model Bank {
  id              Int      @id @default(autoincrement())
  uuid            String   @unique @default(uuid())
  account_holder  String
  bank_name       String
  account_number  String   @unique
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@map("banks")
}
